<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>099-recover_binary_search_tree - Peter's Coding Notes</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://peter14f.github.io/pelican-blog/099-recover_binary_search_tree.html">

        <meta name="author" content="Peter Hsieh" />
        <meta name="keywords" content="Binary Search Trees,Morris Traversal" />
        <meta name="description" content="LeetCode Problem Link This problem brings up a problem that has been overlooked by me. That is the space complexity of a recursive function. The space complexity of a recursive call is the number of calls on the stack. So for inorder tree traversal, the space complexity is O(log n). I am going to present the O(n) space solution first. The idea is to keep track of the previous node in the inorder traversal. If prev is bigger than cur, then we know there is problem. We insert both cur and prev into a list. When the traversal ..." />

        <meta property="og:site_name" content="Peter's Coding Notes" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="099-recover_binary_search_tree"/>
        <meta property="og:url" content="http://peter14f.github.io/pelican-blog/099-recover_binary_search_tree.html"/>
        <meta property="og:description" content="LeetCode Problem Link This problem brings up a problem that has been overlooked by me. That is the space complexity of a recursive function. The space complexity of a recursive call is the number of calls on the stack. So for inorder tree traversal, the space complexity is O(log n). I am going to present the O(n) space solution first. The idea is to keep track of the previous node in the inorder traversal. If prev is bigger than cur, then we know there is problem. We insert both cur and prev into a list. When the traversal ..."/>
        <meta property="article:published_time" content="2015-11-22" />
            <meta property="article:section" content="LeetCode" />
            <meta property="article:tag" content="Binary Search Trees" />
            <meta property="article:tag" content="Morris Traversal" />
            <meta property="article:author" content="Peter Hsieh" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://peter14f.github.io/pelican-blog/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://peter14f.github.io/pelican-blog/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://peter14f.github.io/pelican-blog/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://peter14f.github.io/pelican-blog/theme/css/style.css" type="text/css"/>

        <link href="http://peter14f.github.io/pelican-blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Peter's Coding Notes ATOM Feed"/>



        <link href="http://peter14f.github.io/pelican-blog/feeds/leetcode.atom.xml" type="application/atom+xml" rel="alternate"
              title="Peter's Coding Notes LeetCode ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://peter14f.github.io/pelican-blog/" class="navbar-brand">
Peter's Coding Notes            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://peter14f.github.io/pelican-blog/category/leetcode.html">Leetcode</a>
                        </li>
                        <li >
                            <a href="http://peter14f.github.io/pelican-blog/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://peter14f.github.io/pelican-blog/category/more-questions.html">More questions</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://peter14f.github.io/pelican-blog/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
                <h2>
                    <a href="http://peter14f.github.io/pelican-blog/099-recover_binary_search_tree.html"
                       rel="bookmark"
                       title="Permalink to 099-recover_binary_search_tree">
                        099-recover_binary_search_tree
                    </a>
                </h2>
            <div class="entry-content">
<footer class="post-info">
    <span class="published label label-default">
        <time datetime="2015-11-22T21:15:00-08:00"> Nov 22 2015</time>
    </span>





<span class="label label-default tag-lists">Tags</span>
	<a href="http://peter14f.github.io/pelican-blog/tag/binary-search-trees.html">Binary Search Trees</a>
        /
	<a href="http://peter14f.github.io/pelican-blog/tag/morris-traversal.html">Morris Traversal</a>
    
</footer><!-- /.post-info -->                <div class="full-article">
                <p><a class="reference external" href="https://leetcode.com/problems/recover-binary-search-tree/">LeetCode Problem Link</a></p>
<p>This problem brings up a problem that has been overlooked by me. That is the space complexity of a recursive
function. The space complexity of a recursive call is the number of calls on the stack. So for
inorder tree traversal, the space complexity is O(log n).</p>
<p>I am going to present the O(n) space solution first. The idea is to keep track of the previous node in
the inorder traversal. If <tt class="docutils literal">prev</tt> is bigger than <tt class="docutils literal">cur</tt>, then we know there is problem. We insert both <tt class="docutils literal">cur</tt> and
<tt class="docutils literal">prev</tt> into a list.</p>
<p>When the traversal is done, we either end up with 2 nodes in the list or 4 nodes in the list. In the 2 node case,
we simply swap the values of the two. In the 4 node case, we swap the values of the first node and the last node
only.</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">recoverTree</span><span class="o">(</span><span class="n">TreeNode</span> <span class="n">root</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">==</span><span class="kc">null</span><span class="o">)</span>
        <span class="k">return</span><span class="o">;</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&gt;</span> <span class="n">toSwap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&gt;();</span>

    <span class="n">inOrderTraversal</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">toSwap</span><span class="o">,</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">toSwap</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">toSwap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TreeNode</span> <span class="n">a</span> <span class="o">=</span> <span class="n">toSwap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">TreeNode</span> <span class="n">b</span> <span class="o">=</span> <span class="n">toSwap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">a</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">b</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">toSwap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TreeNode</span> <span class="n">a</span> <span class="o">=</span> <span class="n">toSwap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">TreeNode</span> <span class="n">b</span> <span class="o">=</span> <span class="n">toSwap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">a</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">b</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">inOrderTraversal</span><span class="o">(</span><span class="n">TreeNode</span> <span class="n">cur</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&gt;</span> <span class="n">toSwap</span><span class="o">,</span> <span class="n">TreeNode</span><span class="o">[]</span> <span class="n">prev</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">cur</span><span class="o">==</span><span class="kc">null</span><span class="o">)</span>
        <span class="k">return</span><span class="o">;</span>

    <span class="n">inOrderTraversal</span><span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">toSwap</span><span class="o">,</span> <span class="n">prev</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">prev</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">prev</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">val</span> <span class="o">&gt;</span> <span class="n">cur</span><span class="o">.</span><span class="na">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">toSwap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">prev</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="n">toSwap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cur</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">prev</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">cur</span><span class="o">;</span>

    <span class="n">inOrderTraversal</span><span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">toSwap</span><span class="o">,</span> <span class="n">prev</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
<p>But LeetCode wants a solution that uses only O(1) space. We must use Morris traversal then.</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">recoverTree</span><span class="o">(</span><span class="n">TreeNode</span> <span class="n">root</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">TreeNode</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">root</span><span class="o">;</span>
    <span class="n">TreeNode</span> <span class="n">current</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">TreeNode</span> <span class="n">prev</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">TreeNode</span> <span class="n">toSwapA</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">TreeNode</span> <span class="n">toSwapB</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">cur</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="na">left</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">cur</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">prev</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="o">.</span><span class="na">val</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">toSwapA</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">toSwapA</span> <span class="o">=</span> <span class="n">prev</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">toSwapB</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>

            <span class="n">TreeNode</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="na">left</span><span class="o">;</span>

            <span class="k">while</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">right</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">t</span><span class="o">.</span><span class="na">right</span> <span class="o">!=</span> <span class="n">cur</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">right</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">t</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">cur</span><span class="o">;</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="na">left</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">else</span> <span class="o">{</span>
                <span class="n">t</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

                <span class="n">prev</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">cur</span><span class="o">;</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">prev</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="o">.</span><span class="na">val</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">toSwapA</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">toSwapA</span> <span class="o">=</span> <span class="n">prev</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="n">toSwapB</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
            <span class="o">}</span>

        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">toSwapA</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">toSwapB</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">toSwapA</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">toSwapA</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">toSwapB</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">toSwapB</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

                </div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Peter Hsieh
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://peter14f.github.io/pelican-blog/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://peter14f.github.io/pelican-blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://peter14f.github.io/pelican-blog/theme/js/respond.min.js"></script>


</body>
</html>