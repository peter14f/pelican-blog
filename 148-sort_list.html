<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>148-sort_list - Peter's Coding Notes</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://peter14f.github.io/pelican-blog/148-sort_list.html">

        <meta name="author" content="Peter Hsieh" />
        <meta name="keywords" content="Sorting,Linked Lists,Merge Sort" />
        <meta name="description" content="LeetCode Problem Link If we do merge sort using recursion, the size of the call stack can is O(log n) in the worst case. So this will actually not be constant space. First I will show the recursive solution. By the time the fast pointer reaches null, the slow pointer is at the middle. prev is the previous node of slow. If we set the next pointer of prev to null, then we have successfully divided the linked list into halves. head is the first part of the list. slow is the second part of the list. public ListNode ..." />

        <meta property="og:site_name" content="Peter's Coding Notes" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="148-sort_list"/>
        <meta property="og:url" content="http://peter14f.github.io/pelican-blog/148-sort_list.html"/>
        <meta property="og:description" content="LeetCode Problem Link If we do merge sort using recursion, the size of the call stack can is O(log n) in the worst case. So this will actually not be constant space. First I will show the recursive solution. By the time the fast pointer reaches null, the slow pointer is at the middle. prev is the previous node of slow. If we set the next pointer of prev to null, then we have successfully divided the linked list into halves. head is the first part of the list. slow is the second part of the list. public ListNode ..."/>
        <meta property="article:published_time" content="2015-12-22" />
            <meta property="article:section" content="LeetCode" />
            <meta property="article:tag" content="Sorting" />
            <meta property="article:tag" content="Linked Lists" />
            <meta property="article:tag" content="Merge Sort" />
            <meta property="article:author" content="Peter Hsieh" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://peter14f.github.io/pelican-blog/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://peter14f.github.io/pelican-blog/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://peter14f.github.io/pelican-blog/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://peter14f.github.io/pelican-blog/theme/css/style.css" type="text/css"/>

        <link href="http://peter14f.github.io/pelican-blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Peter's Coding Notes ATOM Feed"/>



        <link href="http://peter14f.github.io/pelican-blog/feeds/leetcode.atom.xml" type="application/atom+xml" rel="alternate"
              title="Peter's Coding Notes LeetCode ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://peter14f.github.io/pelican-blog/" class="navbar-brand">
Peter's Coding Notes            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://peter14f.github.io/pelican-blog/category/leetcode.html">Leetcode</a>
                        </li>
                        <li >
                            <a href="http://peter14f.github.io/pelican-blog/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://peter14f.github.io/pelican-blog/category/trie-dfs.html">Trie, dfs</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://peter14f.github.io/pelican-blog/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
                <h2>
                    <a href="http://peter14f.github.io/pelican-blog/148-sort_list.html"
                       rel="bookmark"
                       title="Permalink to 148-sort_list">
                        148-sort_list
                    </a>
                </h2>
            <div class="entry-content">
<footer class="post-info">
    <span class="published label label-default">
        <time datetime="2015-12-22T13:22:00-08:00"> Dec 22 2015</time>
    </span>





<span class="label label-default tag-lists">Tags</span>
	<a href="http://peter14f.github.io/pelican-blog/tag/sorting.html">Sorting</a>
        /
	<a href="http://peter14f.github.io/pelican-blog/tag/linked-lists.html">Linked Lists</a>
        /
	<a href="http://peter14f.github.io/pelican-blog/tag/merge-sort.html">Merge Sort</a>
    
</footer><!-- /.post-info -->                <div class="full-article">
                <p><a class="reference external" href="https://leetcode.com/problems/sort-list/">LeetCode Problem Link</a></p>
<p>If we do merge sort using recursion, the size of the call stack can is O(log n) in the worst case. So
this will actually not be constant space.</p>
<p>First I will show the recursive solution. By the time the <tt class="docutils literal">fast</tt> pointer reaches null, the <tt class="docutils literal">slow</tt> pointer
is at the middle. <tt class="docutils literal">prev</tt> is the previous node of <tt class="docutils literal">slow</tt>. If we set the next pointer of <tt class="docutils literal">prev</tt> to null, then
we have successfully divided the linked list into halves. <tt class="docutils literal">head</tt> is the first part of the list. <tt class="docutils literal">slow</tt> is the
second part of the list.</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="n">ListNode</span> <span class="nf">sortList</span><span class="o">(</span><span class="n">ListNode</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">mergeSort</span><span class="o">(</span><span class="n">head</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">ListNode</span> <span class="nf">mergeSort</span><span class="o">(</span><span class="n">ListNode</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">head</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">head</span><span class="o">.</span><span class="na">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">return</span> <span class="n">head</span><span class="o">;</span>

    <span class="n">ListNode</span> <span class="n">slow</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
    <span class="n">ListNode</span> <span class="n">fast</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
    <span class="n">ListNode</span> <span class="n">prev</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">fast</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">slow</span><span class="o">;</span>
        <span class="n">slow</span> <span class="o">=</span> <span class="n">slow</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
        <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">fast</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">ListNode</span> <span class="n">a</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
    <span class="n">ListNode</span> <span class="n">b</span> <span class="o">=</span> <span class="n">slow</span><span class="o">;</span>
    <span class="n">prev</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">mergeSort</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">mergeSort</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>

    <span class="n">ListNode</span> <span class="n">curA</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
    <span class="n">ListNode</span> <span class="n">curB</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>

    <span class="n">ListNode</span> <span class="n">sortedHead</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">ListNode</span> <span class="n">sortedTail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="na">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sortedHead</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
        <span class="n">sortedTail</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
        <span class="n">curA</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="n">sortedHead</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
        <span class="n">sortedTail</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
        <span class="n">curB</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
    <span class="o">}</span>



    <span class="k">while</span> <span class="o">(</span><span class="n">curA</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">curB</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">curB</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">curA</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">curA</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;=</span> <span class="n">curB</span><span class="o">.</span><span class="na">val</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">sortedTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">curA</span><span class="o">;</span>
            <span class="n">sortedTail</span> <span class="o">=</span> <span class="n">curA</span><span class="o">;</span>
            <span class="n">curA</span> <span class="o">=</span> <span class="n">curA</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
            <span class="n">sortedTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">curA</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">curB</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">curA</span><span class="o">.</span><span class="na">val</span> <span class="o">&gt;</span> <span class="n">curB</span><span class="o">.</span><span class="na">val</span><span class="o">)){</span>
            <span class="n">sortedTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">curB</span><span class="o">;</span>
            <span class="n">sortedTail</span> <span class="o">=</span> <span class="n">curB</span><span class="o">;</span>
            <span class="n">curB</span> <span class="o">=</span> <span class="n">curB</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
            <span class="n">sortedTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">sortedHead</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
<p>The constant space solution is quite tricky. Please see Simon Tatham's explanation
<a class="reference external" href="http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html">here</a>. <tt class="docutils literal">k</tt> is a power of 2 and
is the unit of the linked list size that we are trying merge right now.</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="n">ListNode</span> <span class="nf">sortList</span><span class="o">(</span><span class="n">ListNode</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ListNode</span> <span class="n">p</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ListNode</span> <span class="n">tail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">numMerges</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">p</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">numMerges</span><span class="o">++;</span>

            <span class="n">ListNode</span> <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">pSize</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">qSize</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>

            <span class="k">while</span> <span class="o">(</span><span class="n">q</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">pSize</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="n">pSize</span><span class="o">++;</span>
            <span class="o">}</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">pSize</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">qSize</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">while</span> <span class="o">(</span><span class="n">pSize</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">(</span><span class="n">qSize</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">q</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">ListNode</span> <span class="n">e</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">pSize</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">q</span><span class="o">;</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">qSize</span><span class="o">--;</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">qSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">q</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">pSize</span><span class="o">--;</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="o">.</span><span class="na">val</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">pSize</span><span class="o">--;</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="o">{</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">q</span><span class="o">;</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">qSize</span><span class="o">--;</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">tail</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                    <span class="n">tail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="o">{</span>
                    <span class="n">tail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                    <span class="n">tail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">tail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">numMerges</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">head</span><span class="o">;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

                </div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Peter Hsieh
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://peter14f.github.io/pelican-blog/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://peter14f.github.io/pelican-blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://peter14f.github.io/pelican-blog/theme/js/respond.min.js"></script>


</body>
</html>